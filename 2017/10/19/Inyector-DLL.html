<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Inyector DLL - Blog de Chris</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Inyector DLL">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Inyector DLL">
    <meta property="og:description" content="">

    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="/apple-touch-icon-precomposed.png" rel="apple-touch-icon">

    <link rel="stylesheet" type="text/css" href="//chrizco.github.io/themes/uno/assets/css/uno.css?v=1508447531023" />

    <link rel="canonical" href="https://chrizco.github.io/2017/10/19/Inyector-DLL.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Blog de Chris" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Inyector DLL" />
    <meta property="og:description" content="A penas comenzar algunos estarán rodeados de dudas y preguntas, así que, iniciaré dando algunas definiciones de manera rápida y ligera, para que todos marchemos al mismo paso. Este post estará dedicado al desarrollo de un Inyector DLL. DLL (Dynamic Link Library) Son archivos que contienen código ejecutable y datos" />
    <meta property="og:url" content="https://chrizco.github.io/2017/10/19/Inyector-DLL.html" />
    <meta property="article:published_time" content="2017-10-19T00:00:00.000Z" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Inyector DLL" />
    <meta name="twitter:description" content="A penas comenzar algunos estarán rodeados de dudas y preguntas, así que, iniciaré dando algunas definiciones de manera rápida y ligera, para que todos marchemos al mismo paso. Este post estará dedicado al desarrollo de un Inyector DLL. DLL (Dynamic Link Library) Son archivos que contienen código ejecutable y datos" />
    <meta name="twitter:url" content="https://chrizco.github.io/2017/10/19/Inyector-DLL.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Blog de Chris",
    "author": {
        "@type": "Person",
        "name": "Chris Cornejo",
        "image": "https://avatars0.githubusercontent.com/u/32885837?v=4",
        "url": "https://chrizco.github.io/author/chrizco/",
        "sameAs": "https://chrizco.github.io/"
    },
    "headline": "Inyector DLL",
    "url": "https://chrizco.github.io/2017/10/19/Inyector-DLL.html",
    "datePublished": "2017-10-19T00:00:00.000Z",
    "description": "A penas comenzar algunos estarán rodeados de dudas y preguntas, así que, iniciaré dando algunas definiciones de manera rápida y ligera, para que todos marchemos al mismo paso. Este post estará dedicado al desarrollo de un Inyector DLL. DLL (Dynamic Link Library) Son archivos que contienen código ejecutable y datos"
}
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Blog de Chris" href="https://chrizco.github.io/rss/" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/atom-one-dark.min.css">
    
        <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

</head>
<body class="post-template no-js">

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    <header class="panel-cover panel-cover--collapsed " style="background-image: url(https://raw.githubusercontent.com/chrizco/chrizco.github.io/master/images/cover-image.jpg)">
      <div class="panel-main">
    
        <div class="panel-main__inner panel-inverted">
        <div class="panel-main__content">
    
            <a href="https://chrizco.github.io" title="link to homepage for Blog de Chris"><img src="https://raw.githubusercontent.com/chrizco/chrizco.github.io/master/images/logo.jpg" width="150px" alt="Blog de Chris logo" class="panel-cover__logo logo" /></a>
            <h1 class="panel-cover__title panel-title"><a href="https://chrizco.github.io" title="link to homepage for Chris Cornejo">Chris Cornejo</a></h1>
            <hr class="panel-cover__divider" />
            <p class="panel-cover__description">Apasionado por el desarrollo de software, los videojuegos y series de tv</p>
            <hr class="panel-cover__divider panel-cover__divider--secondary" />
    
            <div class="navigation-wrapper">
    
              <nav class="cover-navigation cover-navigation--primary">
                <ul class="navigation">
                  <li class="navigation__item"><a href="https://chrizco.github.io/#blog" title="link to Blog de Chris blog" class="blog blog-button">Blog</a></li>
                </ul>
              </nav>
    
              
              
              <nav class="cover-navigation navigation--social">
                <ul class="navigation">
              
              
                  <!-- Twitter -->
                  <li class="navigation__item">
                    <a class="twitter" href="https://twitter.com/0xchriz" title="Twitter account" target="_blank">
                      <i class='icon icon-social-twitter'></i>
                      <span class="label">Twitter</span>
                    </a>
                  </li>
              
              
                  <!-- Github -->
                  <li class="navigation__item">
                    <a class="github" href="https://github.com/chrizco" title="Github account" target="_blank">
                      <i class='icon icon-social-github'></i>
                      <span class="label">Github</span>
                    </a>
                  </li>
                  </li>
              
              
              
              
              
                  <!-- Email -->
                  <li class="navigation__item">
                    <a class="mail" href="mailto:chrispc.dev@gmail.com" title="Email chrispc.dev@gmail.com">
                      <i class='icon icon-mail'></i>
                      <span class="label">Email</span>
                    </a>
                  </li>
              
                </ul>
              </nav>
              
    
            </div>
    
          </div>
    
        </div>
    
        <div class="panel-cover--overlay"></div>
      </div>
    </header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            

  <article class="post-container post-container--single">

    <header class="post-header">
      <h1 class="post-title">Inyector DLL</h1>
      <div class="post-meta">
        <time datetime="19 Oct 2017" class="post-meta__date date">19 Oct 2017</time> &#8226; <span class="post-meta__tags tags"></span>
        <span class="post-meta__author author"><img src="https://avatars0.githubusercontent.com/u/32885837?v&#x3D;4" alt="profile image for Chris Cornejo" class="avatar post-meta__avatar" /> by Chris Cornejo</span>
      </div>
    </header>

    <section class="post">
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A penas comenzar algunos estarán rodeados de dudas y preguntas, así que, iniciaré dando algunas definiciones de manera rápida y ligera, para que todos marchemos al mismo paso. Este post estará dedicado al desarrollo de un Inyector DLL.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dll_dynamic_link_library">DLL (Dynamic Link Library)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Son archivos que contienen código ejecutable y datos que pueden ser usados por uno o más programas. Mediante el uso de DLL, un programa puede ser modularizado en componentes separados. Exclusivos de los sistemas operativos Windows, tienen ".dll" como extensión.
Inyección DLL</p>
</div>
<div class="paragraph">
<p>Es una técnica utilizada para ejecutar código dentro de otro proceso. Comúnmente es utilizada para influir o alterar el comportamiento de un programa.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_inyector_dll">Inyector DLL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Es el programa usado para llevar acabo la Inyección DLL.</p>
</div>
<div class="paragraph">
<p>Existen diversas formas o técnicas para inyectar DLL&#8217;s, en este post explicare la más utilizada. Esta consiste en lo siguiente; Windows provee funciones para crear un hilo en cierta posición de memoria de un proceso externo, para ello reservamos memoria en el proceso, escribimos en ella la ruta de la DLL que queremos inyectar y creamos un hilo pasandole como parámetros el proceso, la dirección de memoria donde se encuentra la función LoadLibrary y la dirección de memoria que reservamos que escribimos anteriormente.</p>
</div>
<div class="paragraph">
<p>Para el desarrollo de este programa haremos uso del lenguaje de programación C++, aun  que no hace falta conocerlo para seguir el post, basta con tener conocimientos de POO.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_herramientas">Herramientas</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>IDE para C/C++</p>
</li>
<li>
<p>Compilador para C/C++</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Yo utilizare CodeBlocks con MinGW (implementación de los compiladores GCC) de 32 bit para Windows, ambos los puedes descargar desde aquí.</p>
</div>
<div class="paragraph">
<p>Sin más preámbulo pasemos a la parte que todos esperaban (aah sí XD).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proyecto_1_inyector">Proyecto 1: Inyector</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_injector_h">Injector.h</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">#ifndef INJECTOR_H
#define INJECTOR_H

class Injector
{
    public:
    void inject(char *dll, char *process);
};

#endif // INJECTOR_H</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_injector_cpp">Injector.cpp</h3>
<div class="paragraph">
<p>#include &lt;windows.h&gt;</p>
</div>
<div class="paragraph">
<p>#include "Injector.h"</p>
</div>
<div class="paragraph">
<p>void Injector::inject(char *dll, char *windowTitle)
{
HWND window;
DWORD pid;
HANDLE process;
LPVOID memory;
SIZE_T write = 0;</p>
</div>
<div class="paragraph">
<p>window = FindWindowEx(0, 0, 0, windowTitle);</p>
</div>
<div class="paragraph">
<p>GetWindowThreadProcessId(window, &amp;pid);</p>
</div>
<div class="paragraph">
<p>process = OpenProcess(PROCESS_ALL_ACCESS, false, pid);</p>
</div>
<div class="paragraph">
<p>memory = VirtualAllocEx(process, 0, strlen(dll),
MEM_COMMIT|MEM_RESERVE, PAGE_EXECUTE_READWRITE);</p>
</div>
<div class="paragraph">
<p>WriteProcessMemory(process, memory, (LPVOID)dll, strlen(dll), &amp;write);</p>
</div>
<div class="paragraph">
<p>HMODULE hModule = LoadLibrary("Kernel32.dll");
FARPROC tsr = GetProcAddress(hModule, "LoadLibraryA");</p>
</div>
<div class="paragraph">
<p>CreateRemoteThread(process, 0, 0, (LPTHRED_START_ROUTINE)tsr,
memory, 0, 0);
}
[/code]</p>
</div>
</div>
<div class="sect2">
<h3 id="_main_cpp">Main.cpp</h3>
<div class="paragraph">
<p>#include &lt;cstring&gt;
using std::strcpy;</p>
</div>
<div class="paragraph">
<p>#include &lt;iostream&gt;
using std::cout;
using std::cin;</p>
</div>
<div class="paragraph">
<p>#include &lt;string&gt;
using std::string;</p>
</div>
<div class="paragraph">
<p>#include "Injector.h"</p>
</div>
<div class="paragraph">
<p>int main()
{
string aux;</p>
</div>
<div class="paragraph">
<p>cout &lt;&lt; "Path DLL: ";
cin &gt;&gt; aux;</p>
</div>
<div class="paragraph">
<p>char *dll = new char[aux.length() + 1];
strcpy(dll, aux.c_str());</p>
</div>
<div class="paragraph">
<p>cout &lt;&lt; "Window Title: ";
cin &gt;&gt; aux;</p>
</div>
<div class="paragraph">
<p>char *windowTitle = new char[aux.length() + 1];
strcpy(windowTitle, aux.c_str());</p>
</div>
<div class="paragraph">
<p>Injector injector;
injector.inject(dll, windowTitle);</p>
</div>
<div class="paragraph">
<p>delete [] dll;
delete [] windowTitle;</p>
</div>
<div class="paragraph">
<p>return 0;
}
[/code]</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proyecto_2_dll">Proyecto 2: DLL</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_main_cpp_2">Main.cpp</h3>
<div class="paragraph">
<p>#include &lt;windows.h&gt;</p>
</div>
<div class="paragraph">
<p>void message()
{
MessageBoxA(0, "Bienvenido a Quickhub!", "DLL Message", 0);
}</p>
</div>
<div class="paragraph">
<p>BOOL APIENTRY DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)
{
switch (fdwReason)
{
case DLL_PROCESS_ATTACH:</p>
</div>
<div class="paragraph">
<p>CreateThread(0, 0, (LPTHREAD_START_ROUTINE)message, 0, 0, 0);
break;</p>
</div>
<div class="paragraph">
<p>case DLL_PROCESS_DETACH:
break;</p>
</div>
<div class="paragraph">
<p>case DLL_THREAD_ATTACH:
break;</p>
</div>
<div class="paragraph">
<p>case DLL_THREAD_DETACH:
break;
}</p>
</div>
<div class="paragraph">
<p>return TRUE; // succesful
}
[/code]</p>
</div>
<div class="paragraph">
<p>IMPORTANTE: si el programa en el vamos a realizar la inyección es de 32 bit, la DLL a inyectar debe ser compilada para 32 bit. Pasa lo mismo con los programas de 64 bit. No podemos inyectar una DLL compilada para 32 bit en un programa de 64 bit, ni viceversa.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_demostraci_n">Demostración</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Seguramente más de uno esté pensando, ¿Qué utilidad tiene agregar un cuadro de dialogo?. Una ballena se devora un mordisco a la vez. En mi siguiente post haremos más que agregar un simple cuadro de dialogo, haremos nuestros propios hacks para videojuegos.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_referencias">Referencias</h2>
<div class="sectionbody">
<div class="paragraph">
<p>DLL - Wikipedia
What is a DLL? - Microsoft
DLL injection - Wikipedia
FindWindowEx - Microsoft
GetWindowThreadProcessId
OpenProcess - Microsoft
VirtualAllocEx - Microsoft
WriteProcessMemory - Microsoft
LoadLibrary - Microsoft
GetProcAddress - Microsoft
CreateRemoteThread - MIcrosoft</p>
</div>
</div>
</div>
    </section>

  </article>

  
  <section class="post-comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'blog-de-chris'; // required: replace example with your forum shortname
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </section>
  



            <footer class="footer">
                <span class="footer__copyright">&copy; 2017. All rights reserved.</span>
                <span class="footer__copyright">Proudly published with <a href="http://hubpress.io" title="link to Hubpress website">Hubpress</a></span>
            </footer>
        </div>
    </div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>

    <script type="text/javascript" src="//chrizco.github.io/themes/uno/assets/js/main.js?v=1508447531023"></script>
    

</body>
</html>
