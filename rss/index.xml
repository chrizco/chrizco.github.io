<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Blog de Chris]]></title><description><![CDATA[Apasionado por el desarrollo de software, los videojuegos y series de tv]]></description><link>https://chrizco.github.io</link><image><url>https://raw.githubusercontent.com/chrizco/chrizco.github.io/master/images/cover-image.jpg</url><title>Blog de Chris</title><link>https://chrizco.github.io</link></image><generator>RSS for Node</generator><lastBuildDate>Thu, 19 Oct 2017 21:50:13 GMT</lastBuildDate><atom:link href="https://chrizco.github.io/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[Inyector DLL]]></title><description><![CDATA[<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A penas comenzar algunos estarán rodeados de dudas y preguntas, así que, + iniciaré dando algunas definiciones de manera rápida y ligera, para que todos marchemos al mismo paso. Este post estará dedicado al desarrollo de un Inyector DLL.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dll_dynamic_link_library">DLL (Dynamic Link Library)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Son archivos que contienen código ejecutable y datos que pueden ser usados por uno o más programas. Mediante el uso de DLL, un programa puede ser modularizado en componentes separados. Exclusivos de los sistemas operativos Windows, tienen ".dll" como extensión.<br>
Inyección DLL</p>
</div>
<div class="paragraph">
<p>Es una técnica utilizada para ejecutar código dentro de otro proceso. Comúnmente es utilizada para influir o alterar el comportamiento de un programa.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_inyector">Inyector</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Es el programa que lleva acabo la inyección de la DLL.</p>
</div>
<div class="paragraph">
<p>Existen diversas formas o técnicas para inyectar DLL&#8217;s, en este post explicare la más utilizada. Esta consiste en lo siguiente; Windows provee funciones para crear un hilo en cierta posición de memoria de un proceso externo, para ello reservamos memoria en el proceso, escribimos en ella la ruta de la DLL que queremos inyectar y creamos un hilo pasandole como parámetros el proceso, la dirección de memoria donde se encuentra la función LoadLibrary y la dirección de memoria que reservamos que escribimos anteriormente.</p>
</div>
<div class="paragraph">
<p>Para el desarrollo de este programa haremos uso del lenguaje de programación C++, aun  que no hace falta conocerlo para seguir el post, basta con tener conocimientos de POO.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_herramientas">Herramientas</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>IDE para C/C++<br></p>
</li>
<li>
<p>Compilador para C/C++</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Yo utilizare CodeBlocks con MinGW (implementación de los compiladores GCC) de 32 bit para Windows, ambos los puedes descargar desde aquí.</p>
</div>
<div class="paragraph">
<p>Sin más preámbulo pasemos a la parte que todos esperaban (aah sí XD).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proyecto_1_inyector">Proyecto 1: Inyector</h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="_injector_h">Injector.h</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#ifndef INJECTOR_H
#define INJECTOR_H

class Injector
{
    public:void inject(char *dll, char *process);
};

#endif // INJECTOR_H</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_injector_cpp">Injector.cpp</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;windows.h&gt;

#include "Injector.h"

// Función que lleva acabo la inyección
void Injector::inject(char *dll, char *windowTitle)
{
    HWND window;
    DWORD pid;
    HANDLE process;
    LPVOID memory;
    SIZE_T write = 0;

    // Buscamos la ventana del proceso a inyectar
    window = FindWindowEx(0, 0, 0, windowTitle);

    // Buscamos el proceso a inyectar
    GetWindowThreadProcessId(window, &amp;pid);

    // Abrimos el proceso
    process = OpenProcess(PROCESS_ALL_ACCESS, false, pid);

    // Reservamos memoria en el proceso para la DLL
    memory = VirtualAllocEx(process, 0, strlen(dll),
    MEM_COMMIT|MEM_RESERVE, PAGE_EXECUTE_READWRITE);

    // Escribimos en el proceso
    WriteProcessMemory(process, memory, (LPVOID)dll, strlen(dll), &amp;write);

    // Obtenemos el modulo de la DLL Kernel32
    HMODULE hModule = LoadLibrary("Kernel32.dll");
    // Obtenemos la dirección en memoria en la que se encuentra la
    // función LoadLibrary
    FARPROC tsr = GetProcAddress(hModule, "LoadLibraryA");

    // Creamos un hilo en el proceso
    CreateRemoteThread(process, 0, 0, (LPTHRED_START_ROUTINE)tsr,memory, 0, 0);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_main_cpp">Main.cpp</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;cstring&gt;
using std::strcpy;

#include &lt;iostream&gt;
using std::cout;
using std::cin;

#include &lt;string&gt;
using std::string;

#include "Injector.h"

int main()
{
    string aux;

    // Pide la ruta de la DLL
    cout &lt;&lt; "Path DLL: ";
    // Lee la ruta y la coloca en aux
    cin &gt;&gt; aux;

    // Convierte la variable aux a char*
    char *dll = new char[aux.length() + 1];
    strcpy(dll, aux.c_str());

    // Pide el título de la ventana
    cout &lt;&lt; "Window Title: ";
    // Lee el título de la ventana y lo coloca en aux
    cin &gt;&gt; aux;

    // Convierte la variable aux a char*
    char *windowTitle = new char[aux.length() + 1];
    strcpy(windowTitle, aux.c_str());

    // Instancia un objeto de la clase Injetor
    Injector injector;
    // Llama al método inject
    injector.inject(dll, windowTitle);

    delete [] dll;
    delete [] windowTitle;

    return 0;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proyecto_2_dll">Proyecto 2: DLL</h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="_main_cpp_2">Main.cpp</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;windows.h&gt;

// Función que muestra un cuadro de dialogo
void message()
{
    MessageBoxA(0, "Bienvenido a Quickhub!", "DLL Message", 0);
}

BOOL APIENTRY DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)
{
    switch (fdwReason)
    {
        case DLL_PROCESS_ATTACH:
            // attach to process
            // return FALSE to fail DLL load
            // Crea un hilo
        CreateThread(0, 0, (LPTHREAD_START_ROUTINE)message, 0, 0, 0);
            break;

        case DLL_PROCESS_DETACH:
            // detach from process
            break;

        case DLL_THREAD_ATTACH:
            // attach to thread
            break;

        case DLL_THREAD_DETACH:
            // detach from thread
            break;
    }

    return TRUE; // succesful
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANTE</strong>: si el programa en el vamos a realizar la inyección es de 32 bit, la DLL a inyectar debe ser compilada para 32 bit. Pasa lo mismo con los programas de 64 bit. No podemos inyectar una DLL compilada para 32 bit en un programa de 64 bit, ni viceversa.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_demostraci_n">Demostración</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Seguramente más de uno esté pensando, ¿Qué utilidad tiene agregar un cuadro de dialogo?. Una ballena se devora un mordisco a la vez. En mi siguiente post haremos más que agregar un simple cuadro de dialogo, haremos nuestros propios hacks para videojuegos.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_referencias">Referencias</h2>
<div class="sectionbody">
<div class="paragraph">
<p>DLL - Wikipedia<br>
What is a DLL? - Microsoft<br>
DLL injection - Wikipedia<br>
FindWindowEx - Microsoft<br>
GetWindowThreadProcessId<br>
OpenProcess - Microsoft<br>
VirtualAllocEx - Microsoft<br>
WriteProcessMemory - Microsoft<br>
LoadLibrary - Microsoft<br>
GetProcAddress - Microsoft<br>
CreateRemoteThread - MIcrosoft</p>
</div>
</div>
</div>]]></description><link>https://chrizco.github.io/2017/10/19/Inyector-DLL.html</link><guid isPermaLink="true">https://chrizco.github.io/2017/10/19/Inyector-DLL.html</guid><category><![CDATA[c++]]></category><category><![CDATA[programacion]]></category><dc:creator><![CDATA[Chris Cornejo]]></dc:creator><pubDate>Thu, 19 Oct 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Hello World!]]></title><description><![CDATA[<div class="paragraph">
<p>Este es el primer post del blog, se dice que el primer paso es el más difícil, así que lo difícil ya esta hecho. En este blog se trataran diversos temas, de las siguientes áreas: programación, electrónica, desarrollo de videojuegos, incluso series y películas relacionadas a estas áreas.</p>
</div>
<div class="paragraph">
<p>Para abordar dichos temas, escribiré un post para ilustrarlos, en los cuales explicaré conceptos, utilizando imágenes, videos. También se incluirán fragmentos de código, los proyectos realizados se alojaran en un repositorio en github para que puedan acceder a ellos.</p>
</div>
<div class="paragraph">
<p>Sin aburrirlos más, me despidos.</p>
</div>]]></description><link>https://chrizco.github.io/2017/10/19/Hello-World.html</link><guid isPermaLink="true">https://chrizco.github.io/2017/10/19/Hello-World.html</guid><dc:creator><![CDATA[Chris Cornejo]]></dc:creator><pubDate>Thu, 19 Oct 2017 00:00:00 GMT</pubDate></item></channel></rss>